<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Seguimiento de trabajos - Info.2B</title>
  <link rel="stylesheet" href="css/estilos.css" />
  <style>
    body {
      background: #0d1117;
      color: #e0e0e0;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }
    header {
      background: #161b22;
      padding: 1rem 2rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    nav a {
      color: #58a6ff;
      margin-left: 1.2rem;
      text-decoration: none;
      font-weight: 500;
    }
    nav a:hover {
      text-decoration: underline;
    }

    .contenedor {
      padding: 3rem 1.5rem;
      max-width: 960px;
      margin: auto;
    }

    h1 {
      text-align: center;
      margin-bottom: 2rem;
      color: #00e676;
      background: linear-gradient(90deg, #00e676, #00bfa5, #00e676);
      background-size: 200% auto;
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      animation: shine 4s linear infinite;
    }

    @keyframes shine {
      to {
        background-position: 200% center;
      }
    }

    .busqueda {
      text-align: center;
      margin-bottom: 2.5rem;
    }

    .busqueda input {
      padding: 0.7rem;
      width: 90%;
      max-width: 400px;
      border-radius: 8px;
      border: none;
      outline: none;
      background-color: #21262d;
      color: #fff;
      font-size: 1rem;
    }

    .resultado {
      background: #1c2128;
      padding: 2rem;
      border-radius: 12px;
      box-shadow: 0 0 12px #00000060;
      animation: fadeIn 0.4s ease-in-out;
    }

    .resultado h3 {
      color: #58a6ff;
      margin-bottom: 1rem;
    }

    .resultado p {
      color: #c9d1d9;
      margin: 0.3rem 0;
    }

    .no-encontrado {
      color: #ff6b6b;
      text-align: center;
      margin-top: 1rem;
    }

    footer {
      margin-top: 4rem;
      padding: 2rem;
      text-align: center;
      background: #161b22;
      color: #777;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(15px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    /* Estilos para la informaci√≥n espec√≠fica del servicio */
    .info-servicio {
      background: rgba(0, 229, 255, 0.05);
      border-radius: 8px;
      padding: 1.5rem;
      margin-top: 1.5rem;
      border-left: 3px solid #00e5ff;
    }
    
    .info-servicio h4 {
      color: #00e5ff;
      margin-top: 0;
      margin-bottom: 1rem;
    }
    
    .campo-destacado {
      background: rgba(0, 230, 118, 0.1);
      padding: 0.8rem;
      border-radius: 6px;
      margin: 0.5rem 0;
    }
    
    .estado-pendiente { color: #ffa726; }
    .estado-proceso { color: #29b6f6; }
    .estado-completado { color: #66bb6a; }
    .estado-entregado { color: #00e676; }
  </style>
</head>
<body>
  <header>
    <h1>Info.2B</h1>
    <nav>
      <a href="index.html">Inicio</a>
      <a href="servicios.html">Servicios</a>
      <a href="seguimiento.html">Seguimiento</a>
      <a href="blog.html">Blog</a>
      <a href="contacto.html">Contacto</a>
    </nav>
  </header>

  <main class="contenedor">
    <h1>Seguimiento de Trabajo</h1>

    <div class="busqueda">
      <input type="text" id="buscador" placeholder="üîç Ingresa tu c√≥digo de seguimiento" />
    </div>

    <div id="resultado" class="resultado" style="display: none;"></div>
    <p id="noEncontrado" class="no-encontrado" style="display: none;">
      ‚ùå No se encontr√≥ ning√∫n trabajo con ese c√≥digo.
    </p>
  </main>

  <footer>
    &copy; 2025 Info.2B - Seguimiento t√©cnico transparente y en tiempo real
  </footer>

  <!-- Firebase SDK -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/11.9.1/firebase-app.js";
  import { getFirestore, collection, query, where, getDocs } from "https://www.gstatic.com/firebasejs/11.9.1/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyBJoYFUAJLkaeXA4Lu6T_GujtIgs96Ka0I",
    authDomain: "info2b-firebase.firebaseapp.com",
    projectId: "info2b-firebase",
    storageBucket: "info2b-firebase.appspot.com",
    messagingSenderId: "660484913472",
    appId: "1:660484913472:web:e6aee88dc824a0c3e362a5"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  document.addEventListener("DOMContentLoaded", () => {
    const buscador = document.getElementById("buscador");
    const resultadoDiv = document.getElementById("resultado");
    const noEncontrado = document.getElementById("noEncontrado");

    buscador.addEventListener("input", async () => {
      const valor = buscador.value.trim().toUpperCase();

      if (!valor) {
        resultadoDiv.style.display = 'none';
        noEncontrado.style.display = 'none';
        return;
      }

      try {
        const trabajosRef = collection(db, "trabajos");
        const q = query(trabajosRef, where("codigo_seguimiento", "==", valor));
        const querySnapshot = await getDocs(q);

        if (querySnapshot.empty) {
          resultadoDiv.style.display = 'none';
          noEncontrado.style.display = 'block';
          return;
        }

        const docSnap = querySnapshot.docs[0];
        const trabajo = docSnap.data();

        const fechaIngreso = trabajo.fecha_ingreso?.toDate?.().toLocaleDateString?.() || "No disponible";
        const fechaEntrega = trabajo.fecha_entrega?.toDate?.().toLocaleDateString?.() || "No registrada";

        // Determinar clase CSS para el estado
        let estadoClass = "estado-pendiente";
        if (trabajo.estado?.toLowerCase().includes("proceso")) estadoClass = "estado-proceso";
        if (trabajo.estado?.toLowerCase().includes("completado")) estadoClass = "estado-completado";
        if (trabajo.estado?.toLowerCase().includes("entregado")) estadoClass = "estado-entregado";

        // Generar informaci√≥n espec√≠fica del servicio
        const infoServicio = generarInfoServicio(trabajo);

        resultadoDiv.innerHTML = `
          <h3 style="color:#64ffda;">üîç Detalles del trabajo</h3>
          <div class="campo-destacado">
            <p><strong>üìå Cliente:</strong> ${trabajo.nombre_completo || "No registrado"}</p>
            <p><strong>üìû Contacto:</strong> ${trabajo.telefono || "No registrado"} | ${trabajo.correo || "No registrado"}</p>
            <p><strong>üìÖ Fecha de ingreso:</strong> ${fechaIngreso}</p>
            <p><strong>üìÖ Fecha de entrega estimada:</strong> ${fechaEntrega}</p>
          </div>
          
          <p><strong>üõ† Servicio solicitado:</strong> ${trabajo.servicio_solicitado || "No registrado"}</p>
          <p><strong>üìù Descripci√≥n del problema:</strong> ${trabajo.problema || "No registrado"}</p>
          <p><strong>üìà Prioridad:</strong> ${trabajo.prioridad || "Normal"}</p>
          <p><strong>üìä Estado:</strong> <span class="${estadoClass}">${trabajo.estado || "Pendiente"}</span></p>
          
          ${infoServicio}
          
          <div style="margin-top: 1.5rem; padding-top: 1rem; border-top: 1px solid #333;">
            <p><strong>üî¢ C√≥digo de seguimiento:</strong> ${trabajo.codigo_seguimiento || "No disponible"}</p>
          </div>
        `;

        resultadoDiv.style.display = 'block';
        noEncontrado.style.display = 'none';
      } catch (error) {
        console.error("‚ùå Error al buscar:", error);
        resultadoDiv.innerHTML = `<p style='color:red;'>Error al buscar. Int√©ntalo m√°s tarde.</p>`;
        resultadoDiv.style.display = 'block';
        noEncontrado.style.display = 'none';
      }
    });

    // Funci√≥n para generar informaci√≥n espec√≠fica del servicio
    function generarInfoServicio(trabajo) {
      const servicio = trabajo.servicio_solicitado?.toLowerCase() || "";
      let contenido = "";
      
      // Detectar el tipo de servicio y mostrar informaci√≥n relevante
      if (servicio.includes("reparaci√≥n") || servicio.includes("reparacion")) {
        contenido = `
          <div class="info-servicio">
            <h4>üîß Informaci√≥n de Reparaci√≥n</h4>
            <p><strong>¬øTiene garant√≠a?:</strong> ${trabajo.garantia || "No especificado"}</p>
            ${trabajo.garantia === "No" ? `<p><strong>Motivo sin garant√≠a:</strong> ${trabajo.razon_no_garantia || "No especificado"}</p>` : ""}
            <p><strong>Modelo del equipo:</strong> ${trabajo.modelo_equipo || "No especificado"}</p>
            <p><strong>Tipo de falla:</strong> ${trabajo.tipo_falla || "No especificado"}</p>
          </div>
        `;
      } else if (servicio.includes("mantenimiento")) {
        contenido = `
          <div class="info-servicio">
            <h4>üõ†Ô∏è Informaci√≥n de Mantenimiento</h4>
            <p><strong>Tipo de equipo:</strong> ${trabajo.tipo_equipo || "No especificado"}</p>
            <p><strong>Frecuencia:</strong> ${trabajo.frecuencia_mantenimiento || "No especificado"}</p>
          </div>
        `;
      } else if (servicio.includes("formateo")) {
        contenido = `
          <div class="info-servicio">
            <h4>üíª Informaci√≥n de Formateo</h4>
            <p><strong>Sistema operativo:</strong> ${trabajo.sistema_operativo || "No especificado"}</p>
            <p><strong>Respaldo de archivos:</strong> ${trabajo.respaldo_archivos || "No especificado"}</p>
          </div>
        `;
      } else if (servicio.includes("c√°mara") || servicio.includes("camara")) {
        contenido = `
          <div class="info-servicio">
            <h4>üìπ Informaci√≥n de C√°maras</h4>
            <p><strong>Tipo de instalaci√≥n:</strong> ${trabajo.tipo_instalacion || "No especificado"}</p>
            <p><strong>Ubicaci√≥n:</strong> ${trabajo.ubicacion_camara || "No especificado"}</p>
            <p><strong>N√∫mero de c√°maras:</strong> ${trabajo.numero_camaras || "No especificado"}</p>
          </div>
        `;
      } else if (servicio.includes("red")) {
        contenido = `
          <div class="info-servicio">
            <h4>üì° Informaci√≥n de Redes</h4>
            <p><strong>Tipo de red:</strong> ${trabajo.tipo_red || "No especificado"}</p>
            <p><strong>Alcance requerido:</strong> ${trabajo.alcance_red || "No especificado"}</p>
            <p><strong>Ubicaci√≥n:</strong> ${trabajo.ubicacion_red || "No especificado"}</p>
          </div>
        `;
      } else {
        contenido = `
          <div class="info-servicio">
            <h4>‚ÑπÔ∏è Informaci√≥n del Servicio</h4>
            <p>No hay informaci√≥n adicional disponible para este servicio.</p>
          </div>
        `;
      }
      
      return contenido;
    }
  });
</script>
</body>
</html>
